let choice1 = [
    'There',
    'were',
    'an',
    'ass',
    'and',
    'a',
    'lap',
    'dog',
    'who',
    'belonged',
    'to',
    'the',
    'same',
    'master.',
    'The',
    'ass',
    'was',
    'tied',
    'up',
    'in',
    'the',
    'stable,',
    'had',
    'plenty',
    'of',
    'corn',
    'and',
    'hay',
    'to',
    'eat,',
    'and',
    'was',
    'as',
    'well',
    'off',
        'as',
        'an',
        'ass',
        'could',
        'be.',
        'The',
        'little',
        'dog',
        'was',
        'always',
        'sporting',
        'and',
        'gamboling',
        'about,',
        'caressing',
        'and',
        'fawning',
        'upon',
        'his',
        'master',
        'in',
        'a',
        'thousand',
        'amusing',
        'ways,',
        'so',
        'that',
        'he',
        'became',
        'a',
        'great',
        'favorite,',
        'and',
        'was',
        'permitted',
        'to',
        'lie',
        'in',
        'his',
        "master's",
        "lap.",
        'The',
        'ass,',
        'indeed,',
        'had',
        'enough',
        'to',
        'do;',
        'he',
        'was',
        'drawing',
        'wood',
        'all',
        'day',
        'and',
        'had',
        'to',
        'take',
        'his',
        'turn',
        'at',
        'the',
        'mill',
        'at',
        'night.',
        'But',
        'while',
        'he',
        'grieved',
        'over',
        'his',
        'own',
        'lot,',
        'it',
        'galled',
        'him',
        'more',
        'to',
        'see',
        'the',
        'lap',
        'dog',
        'living',
        'in',
        'such',
        'ease',
        'and',
        'Thinking',
        'that',
        'if',
        'he',
        'acted',
        'a',
        'like',
        'part',
        'to',
        'his',
        'master,',
        'he',
        'should',
        'fare',
        'the',
        'same,',
        'he',
        'broke',
        'one',
        'day',
        'from',
        'his',
        'halter',
        'and,',
        'rushing',
        'into',
        'the',
        'hall,',
        'began',
        'to',
        'kick',
        'and',
        'prance',
        'about',
        'in',
        'the',
        'strangest',
        'fashion.',
        'Swishing',
        'his',
        'tail',
        'and',
        'mimicking',
        'the',
        'frolics',
        'of',
        'the',
        'favorite,',
        'he',
        'upset',
        'the',
        'table',
        'where',
        'his',
        'master',
        'was',
        'at',
        'dinner,',
        'breaking',
        'it',
        'in',
        'two',
        'and',
        'smashing',
        'all',
        'the',
        'crockery.',
        'Nor',
        'would',
        'he',
        'stop',
        'until',
        'he',
        'jumped',
        'upon',
        'his',
        'master',
        'and',
        'pawed',
        'him',
        'with',
        'his',
        'rough-shod',
        'The',
        'servants,',
        'seeing',
        'their',
        'master',
        'in',
        'no',
        'little',
        'danger,',
        'thought',
        'it',
        'was',
        'now',
        'high',
        'time',
        'to',
        'interfere.',
        'Having',
        'released',
        'him',
        'from',
        'the',
        "ass'",
        'caresses,',
        'they',
        'so',
        'belabored',
        'the',
        'silly',
        'creature',
        'with',
        'sticks',
        'and',
        'staves',
        'that',
        'he',
        'never',
        'got',
        'up',
        'again.',
        'As',
        'he',
        'breathed',
        'his',
        'last,',
        'he',
        'exclaimed,',
        '"Why',
        'could',
        'not',
        'I',
        'have',
        'been',
        'satisfied',
        'with',
        'my',
        'natural',
        'position,',
        'without',
        'attempting,',
        'by',
        'tricks',
        'and',
        'grimaces,',
        'to',
        'imitate',
        'one',
        'who',
        'was',
        'but',
        'a',
        'puppy',
        'after'
    ];

let choice2 = [
'Dolphin',
'is',
'a',
'common',
'name',
'of',
'aquatic',
'mammals',
'within',
'the',
'infraorder',
'Cetacea.',
'The',
'term',
'dolphin',
'usually',
'refers',
'to',
'the',
'extant',
'families',
'Delphinidae',
'(the',
'oceanic',
'dolphins),',
'Platanistidae',
'(the',
'Indian',
'river',
'dolphins),',
'Iniidae',
'(the',
'New',
'World',
'river',
'dolphins),',
'and',
'Pontoporiidae',
'(the',
'brackish',
'dolphins),',
'and',
'the',
'extinct',
'Lipotidae',
'(baiji',
'or',
'Chinese',
'river',
'dolphin).',
'There',
'are',
'40',
'extant',
'species',
'named',
'as',
'Dolphins',
'range',
'in',
'size',
'from',
'the',
'1.7-metre-long',
'(5',
'ft',
'7',
'in)',
'long',
'and',
'50-kilogram',
'(110-pound)',
'Maui\'s',
'dolphin',
'to',
'the',
'9.5',
'm',
'(31',
'ft',
'2',
'in)',
'and',
'10-metric-ton',
'(11-short-ton)',
'killer',
'whale.',
'Several',
'species',
'exhibit',
'sexual',
'dimorphism,',
'in',
'that',
'the',
'males',
'are',
'larger',
'than',
'females.',
'They',
'have',
'streamlined',
'bodies',
'and',
'two',
'limbs',
'that',
'are',
'modified',
'into',
'flippers.',
'Though',
'not',
'quite',
'as',
'flexible',
'as',
'seals,',
'some',
'dolphins',
'can',
'travel',
'at',
'speeds',
'29',
'km/h',
'(18',
'mph)',
'for',
'short',
'distances.',
'Dolphins',
'use',
'their',
'conical',
'shaped',
'teeth',
'to',
'capture',
'fast',
'moving',
'prey.',
'They',
'have',
'well-developed',
'hearing',
'which',
'is',
'adapted',
'for',
'both',
'air',
'and',
'water',
'and',
'is',
'so',
'well',
'developed',
'that',
'some',
'can',
'survive',
'even',
'if',
'they',
'are',
'blind.',
'Some',
'species',
'are',
'well',
'adapted',
'for',
'diving',
'to',
'great',
'depths.',
'They',
'have',
'a',
'layer',
'of',
'fat,',
'or',
'blubber,',
'under',
'the',
'skin',
'to',
'keep',
'warm',
'in',
'the',
'cold',
'Although',
'dolphins',
'are',
'widespread,',
'most',
'species',
'prefer',
'the',
'warmer',
'waters',
'of',
'the',
'tropic',
'zones,',
'but',
'some,',
'like',
'the',
'right',
'whale',
'dolphin,',
'prefer',
'colder',
'climates.',
'Dolphins',
'feed',
'largely',
'on',
'fish',
'and',
'squid,',
'but',
'a',
'few,',
'like',
'the',
'killer',
'whale,',
'feed',
'on',
'large',
'mammals,',
'like',
'seals.',
'Male',
'dolphins',
'typically',
'mate',
'with',
'multiple',
'females',
'every',
'year,',
'but',
'females',
'only',
'mate',
'every',
'two',
'to',
'three',
'years.',
'Calves',
'are',
'typically',
'born',
'in',
'the',
'spring',
'and',
'summer',
'months',
'and',
'females',
'bear',
'all',
'the',
'responsibility',
'for',
'raising',
'them.',
'Mothers',
'of',
'some',
'species',
'fast',
'and',
'nurse',
'their',
'young',
'for',
'a',
'relatively',
'long',
'period',
'of',
'time.',
'Dolphins',
'produce',
'a',
'variety',
'of',
'vocalizations,',
'usually',
'in',
'the',
'form',
'of',
'clicks',
'and',
'Dolphins',
'are',
'sometimes',
'hunted',
'in',
'places',
'such',
'as',
'Japan,',
'in',
'an',
'activity',
'known',
'as',
'dolphin',
'drive',
'hunting.',
'Besides',
'drive',
'hunting,',
'they',
'also',
'face',
'threats',
'from',
'bycatch,',
'habitat',
'loss,',
'and',
'marine',
'pollution.',
'Dolphins',
'have',
'been',
'depicted',
'in',
'various',
'cultures',
'worldwide.',
'Dolphins',
'occasionally',
'feature',
'in',
'literature',
'and',
'film,',
'as',
'in',
'the',
'film',
'series',
'Free',
'Willy.',
'Dolphins',
'are',
'sometimes',
'kept',
'in',
'captivity',
'and',
'trained',
'to',
'perform',
'tricks.',
'The',
'most',
'common',
'dolphin',
'species',
'in',
'captivity',
'is',
'the',
'bottlenose',
'dolphin,',
'while',
'there',
'are',
'around',
'60',
'captive',
'killer'
];

choice3 = [
    'Dolphins',
    'are',
    'highly',
    'social',
    'animals,',
    'often',
    'living',
    'in',
    'pods',
    'of',
    'up',
    'to',
    'a',
    'dozen',
    'individuals,',
    'though',
    'pod',
    'sizes',
    'and',
    'structures',
    'vary',
    'greatly',
    'between',
    'species',
    'and',
    'locations.',
    'In',
    'places',
    'with',
    'a',
    'high',
    'abundance',
    'of',
    'food,',
    'pods',
    'can',
    'merge',
    'temporarily,',
    'forming',
    'a',
    'superpod;',
    'such',
    'groupings',
    'may',
    'exceed',
    '1,000',
    'dolphins.',
    'Membership',
    'in',
    'pods',
    'is',
    'not',
    'rigid;',
    'interchange',
    'is',
    'common.',
    'Dolphins',
    'can,',
    'however,',
    'establish',
    'strong',
    'social',
    'bonds;',
    'they',
    'will',
    'stay',
    'with',
    'injured',
    'or',
    'ill',
    'individuals,',
    'even',
    'helping',
    'them',
    'to',
    'breathe',
    'by',
    'bringing',
    'them',
    'to',
    'the',
    'surface',
    'if',
    'needed.',
    'This',
    'altruism',
    'does',
    'not',
    'appear',
    'to',
    'be',
    'limited',
    'to',
    'their',
    'own',
    'species.',
    'The',
    'dolphin',
    'Moko',
    'in',
    'New',
    'Zealand',
    'has',
    'been',
    'observed',
    'guiding',
    'a',
    'female',
    'pygmy',
    'sperm',
    'whale',
    'together',
    'with',
    'her',
    'calf',
    'out',
    'of',
    'shallow',
    'water',
    'where',
    'they',
    'had',
    'stranded',
    'several',
    'times.[58]',
    'They',
    'have',
    'also',
    'been',
    'seen',
    'protecting',
    'swimmers',
    'from',
    'sharks',
    'by',
    'swimming',
    'circles',
    'around',
    'the',
    'swimmers',
    'or',
    'charging',
    'the',
    'sharks',
    'to',
    'make',
    'them',
    'go',
    'Dolphins',
    'communicate',
    'using',
    'a',
    'variety',
    'of',
    'clicks,',
    'whistle-like',
    'sounds',
    'and',
    'other',
    'vocalizations.',
    'Dolphins',
    'also',
    'use',
    'nonverbal',
    'communication',
    'by',
    'means',
    'of',
    'touch',
    'and',
    'Dolphins',
    'also',
    'display',
    'culture,',
    'something',
    'long',
    'believed',
    'to',
    'be',
    'unique',
    'to',
    'humans',
    '(and',
    'possibly',
    'other',
    'primate',
    'species).',
    'In',
    'May',
    '2005,',
    'a',
    'discovery',
    'in',
    'Australia',
    'found',
    'Indo-Pacific',
    'bottlenose',
    'dolphins',
    '(Tursiops',
    'aduncus)',
    'teaching',
    'their',
    'young',
    'to',
    'use',
    'tools.',
    'They',
    'cover',
    'their',
    'snouts',
    'with',
    'sponges',
    'to',
    'protect',
    'them',
    'while',
    'foraging.',
    'This',
    'knowledge',
    'is',
    'mostly',
    'transferred',
    'by',
    'mothers',
    'to',
    'daughters,',
    'unlike',
    'simian',
    'primates,',
    'where',
    'knowledge',
    'is',
    'generally',
    'passed',
    'on',
    'to',
    'both',
    'sexes.',
    'Using',
    'sponges',
    'as',
    'mouth',
    'protection',
    'is',
    'a',
    'learned',
    'behavior.[62]',
    'Another',
    'learned',
    'behavior',
    'was',
    'discovered',
    'among',
    'river',
    'dolphins',
    'in',
    'Brazil,',
    'where',
    'some',
    'male',
    'dolphins',
    'use',
    'weeds',
    'and',
    'sticks',
    'as',
    'part',
    'of',
    'a',
    'sexual',
    'Forms',
    'of',
    'care-giving',
    'between',
    'fellows',
    'and',
    'even',
    'for',
    'members',
    'of',
    'different',
    'species',
    'are',
    'recorded',
    'in',
    'various',
    'species',
    'â€“',
    'such',
    'as',
    'trying',
    'to',
    'save',
    'weakened',
    'fellows',
    'or',
    'female',
    'pilot',
    'whales',
    'holding',
    'up',
    'dead',
    'calves',
    'for',
    'long',
    'Dolphins',
    'engage',
    'in',
    'acts',
    'of',
    'aggression',
    'towards',
    'each',
    'other.',
    'The',
    'older',
    'a',
    'male',
    'dolphin',
    'is,',
    'the',
    'more',
    'likely',
    'his',
    'body',
    'is',
    'to',
    'be',
    'covered',
    'with',
    'bite',
    'scars.',
    'Male',
    'dolphins',
    'can',
    'get',
    'into',
    'disputes',
    'over',
    'companions',
    'and',
    'females.',
    'Acts',
    'of',
    'aggression',
    'can',
    'become',
    'so',
    'intense',
    'that',
    'targeted',
    'dolphins',
    'sometimes',
    'go',
    'into',
    'exile',
    'after',
    'losing',
    'a',
    'Male',
    'bottlenose',
    'dolphins',
    'have',
    'been',
    'known',
    'to',
    'engage',
    'in',
    'infanticide.',
    'Dolphins',
    'have',
    'also',
    'been',
    'known',
    'to',
    'kill',
    'porpoises',
    'for',
    'reasons',
    'which',
    'are',
    'not',
    'fully',
    'understood,',
    'as',
    'porpoises',
    'generally',
    'do',
    'not',
    'share',
    'the',
    'same',
    'diet',
    'as',
    'dolphins',
    'and',
    'are',
    'therefore',
    'not',
    'competitors',
    'for',
    'food',
    'supplies.',
    'The',
    'Cornwall',
    'Wildlife',
    'Trust',
    'records',
    'about',
    'one',
    'such',
    'death',
    'a',
    'year.',
    'Possible',
    'explanations',
    'include',
    'misdirected',
    'infanticide,',
    'misdirected',
    'sexual',
    'aggression',
    'or',
    'play'
]


window.addEventListener('load', init); 
    
//html elements
const wordInput = document.querySelector('#word-input');
const currentWords = document.querySelector('#current-words');
const scoreDisplay = document.querySelector('#score'); 
const timeDisplay = document.querySelector('#time'); 
const message = document.querySelector('#message'); 
const diffSelector = document.querySelector('#diffSelect');
const errors = document.querySelector('#errors');
const log = document.getElementById("log");
const statistics = document.querySelector("#statistics");



//Globals
let currentLevel = 0; 
let errorCount = 0; 
let time = 0; 
let score = 0; 
let isPlaying = false; 
let isPaused = false;
let count = 0; // Position in the story
let plays = 1; // how many times you have played this session
let correctText = "<span class = 'text-success'>Correct!</span>";
let incorrectText = "<span class = 'text-danger'>Mispelled</span>";
let average = 0; // average wpm
let averageError = 0; // average errors
let errorLog = [];
let words = [];
let choices = [choice1, choice2, choice3];


// Google Charts 
let scores = [['Attempt', 'WPM', 'Errors']];

// Initialize the typing test
function init()
{
    //choose which text to type
    chooseText();
    //Load the typing text
    showWord(words); 
    //Listen for typing
    wordInput.addEventListener('keypress', spacePressed);
    //tick tock
    typingTime = setInterval(clock, 1000); 
}

// choose at random text that displays on screen
function chooseText()
{
    let choice = choices.length; 
    choice = (Math.floor((Math.random() * 100) + 1) % choice);
    words = choices[choice];
    console.log(choice);
}

//Check if the current word in question matches the word typed 
function matchWords()
{
    if(!isPaused)
    {
        if(wordInput.value === words[count] || wordInput.value === " " + words[count])
        {
            message.innerHTML = correctText;
            return true; 
            
        } 
        else 
        {
            message.innerHTML =  incorrectText;
            errorLogger();
            return false;
        }
    }
}

//Show the next 8 words in the typing sequence
function showWord(words)
{
    
    currentWords.innerHTML = "<span style = 'background-color: #99ccff; border-radius: 3px; padding: 1px 3px 1px 3px'> <strong>" + words[count] +"</span>" +' ' + words[count + 1] + ' ' + words[count + 2] + ' ' + words[count + 3] + ' ' + words[count + 4]+ ' ' + words[count + 5] + ' ' + words[count + 6] +  ' ' + words[count + 7] + '</strong>';
    // + ' ' + words[count + 1] + ' ' + words[count + 2] + ' ' + words[count + 3] + ' ' + words[count + 4]+ ' ' + words[count + 5] + ' ' + words[count + 6] +  ' ' + words[count + 7] 
}


function clock()
{
    
    if(time < 60 && isPlaying)
    {
        // Increase time
        time++;
    }
    else if (score > 0)
    {
        // Game is over 
        isPlaying = false;
        isPaused = true;
        message.innerHTML = "<span class = 'text-success'>Press space to type again!<span>"; // Need to add set of possible responses here...
        currentWords.innerHTML = "<span style = 'background-color: #99ccff; border-radius: 3px; padding: 1px 3px 1px 3px'> <strong>That was a good run! </strong>";
        count = 0; 

        // data for google chart 
        
        scores.push([plays,score,errorCount]);
        drawChart(scores); 

        // Other data to display
        average = averageScore(scores);
        averageErrors = averageErrorCalc(scores); 
        statistics.innerHTML = "<strong>Average WPM: " + average + '<br>' + " Average Errors: " + averageErrors + "<br>" + "Error List: </strong>";
        
        // Add errors from errorlog to display 
        let counter = 0; 
        while(counter < errorLog.length)
        {
            statistics.innerHTML = statistics.innerHTML +  "<br>" + (counter + 1) + ". " + errorLog[counter]; 
            counter ++; 
        }
        errorLog = []; 
        chooseText();
        // Update Game State
        plays += 1;
        time = 0; 
        score = 0; 
        errorCount = 0;
        
        
    }
    // Show time 
    timeDisplay.innerHTML = time; 
}

// Checks if the word typed is equal to the word on the text everytime space is pressed. 
function spacePressed(e)
{
    
     if(e.code === "Space")
     {
        if(matchWords())
        {   
            if(time < 60)
            {    
                score++;
                scoreDisplay.innerHTML = score; 
            }
        } 
        else 
        {
            errorCount++;
        }

        
        if(!isPaused){
            isPlaying = true;
            count = count + 1;
            errors.innerHTML = errorCount;
            wordInput.value = '';
        }else{
            isPaused = false; 
            message.innerHTML = "<span class = 'text-success'>Alright, start your engines and get ready to TYPE!<span>";
            wordInput.value = ''; 
        }
        showWord(words); 
        
     }
     // testing code
     if(e.code === "Equal")
     {
         time = 59; 
         score = 1; 
     }
}


// Charts 
function drawChart(dataTable) 
{
var data = google.visualization.arrayToDataTable(dataTable);

var options = {
  //title: 'Your Performance',
  curveType: 'function',
  legend: { position: 'bottom' }
};

var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));

chart.draw(data, options);
}

//average wpm calculator  

function averageScore(scores)
{
average = 0; 
let i = 1; 
while(i < scores.length)
{
    average = average + scores[i][1]; 
    i++; 
}
average = average / (scores.length - 1);
return average; 

}

//average errors calculator  

function averageErrorCalc(scores)
{
averageError = 0; 
let i = 1; 
while(i < scores.length)
{
    averageError = averageError + scores[i][2]; 
    i++;  
}
averageError = averageError / (scores.length - 1);
return averageError; 
}


//Error Log: 
// Condition for words match: wordInput.value === words[count] || wordInput.value === " " + words[count] 
let matching = true;
let i = 1; // since there is a space appended to the beginning of every word
let j = 0; //our secondary counting variable, but if you do this sort of stuff, I guess you already knew that
let punctuation = [',', '"', "'", '.', '?', '!', ';', ':' ];
let symbols = ['@', '#', '$', '%', '^', '&', '*', '(', ')', '{', '}', '[', ']', '-', '_', '=', '+', '\\', '/', '`', '~', '<', '>'];
let numbers = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0']; 
let determined = false; // determined what kind of char was missed

function errorLogger()
{
i = 1; 
matching = true;
while(matching)
{
    // assign characters to separate variables for testing
    let iChar = wordInput.value[i]; // current letter in input
    let wChar = words[count][i-1]; // current letter in word in displayed word\
    if(iChar != wChar)
    {
        
        j = 0; 
        matching = false;
        determined = false; 
        if (wChar === 'undefined')
        { 
            error = "You put a '" + iChar + "' instead of a space here: '" + words[count] + "'<br>Your input: '" + wordInput.value + "'.";
            determined = true;
        }
        while(j < punctuation.length - 1 && !determined)
        {
            if(wChar === punctuation.length[j])
            {
                determined = true; 
                error = "You missed the punctuation here: The '"+ wChar +"' in '" + words[count] + "'<br>Your input: '" + wordInput.value + "'.";
            }
            else
            {
                j++;
            }
        }
        if(!determined)
        {
            j = 0; 
            while(j < symbols.length - 1 && !determined)
            {
                if(wChar === symbols.length[j])
                {
                    
                    determined = true; 
                    error = "You missed the symbol here: The '"+ wChar +"' in '"+ words[count] + "'<br>Your input: '" + wordInput.value + "'.";
                }
                else
                {
                    j++;
                }
            }
        }
        if(!determined)
        {
            j = 0; 
            while(j < numbers.length - 1 && !determined)
            {
                if(wChar === numbers.length[j])
                {
                    if(wChar === 'undefined')
                    {
                        
                    }
                    determined = true; 
                    error = "You missed the number here: The '"+ wChar +"' in '" + words[count] + "'<br>Your input: '" + wordInput.value + "'.";
                }
                else
                {
                    j++;
                }
            }
        }
        if(!determined)
        {
            error = "You mispelled: '" + words[count] + "'<br>Your input: '" + wordInput.value + "'.";
        }
        errorLog.push(error);
    }
    else
    {
        i++;
    }
    
}


}

// localstorage
function localStorage()
{
    
}